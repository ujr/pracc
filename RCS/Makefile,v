head	1.6;
access;
symbols;
locks
	ujr:1.6; strict;
comment	@# @;


1.6
date	2008.04.14.19.16.38;	author ujr;	state Exp;
branches;
next	1.5;

1.5
date	2008.04.12.06.45.46;	author ujr;	state Exp;
branches;
next	1.4;

1.4
date	2008.04.04.16.40.19;	author ujr;	state Exp;
branches;
next	1.3;

1.3
date	2008.03.03.10.13.36;	author ujr;	state Exp;
branches;
next	1.2;

1.2
date	2008.01.16.23.30.56;	author ujr;	state Exp;
branches;
next	1.1;

1.1
date	2008.01.16.15.54.27;	author ujr;	state Exp;
branches;
next	;


desc
@Makefile for the pracc backend and tools
@


1.6
log
@Header pracc.h now generated from Makefile settings using subst.
@
text
@# Makefile for pracc project
# $Id: Makefile,v 1.5 2008/04/12 06:45:46 ujr Exp ujr $

# Where the backend goes: Ubuntu/Gentoo/etc differ
BACKDIR = /usr/lib/cups/backend
#BACKDIR = /usr/libexec/cups/backend

# ** Configuration:
# Use these variables to adjust pracc to your system.
# They will be used to generate the pracc.h header,
# which in turn is included by all pracc programs.

# Owner for pracc files (root is fine):
PRACCOWNER = root
# Group for pracc files (dedicated group):
PRACCGROUP = lpadmin
# Name of the default account:
PRACCDEFLT = default

# The accounting log file:
PRACCLOG = /var/print/pracc.log
# The pagecount log file:
PRACCPCLOG = /var/print/pc.log

# Where pracc files are stored:
PRACCDIR = /var/print/pracc
# Where pracc tools are installed:
PRACCBIN = /var/print/bin
# Where pracc documentation lives:
PRACCDOC = /var/print/doc
# Where the pracc.cgi is installed:
PRACCCGI = /var/print/cgi

# Admin group (can make changes):
PRACCPOKE = pracc-admin
# Observer group (read-only):
PRACCPEEK = pracc-watch

# Remove symtab and reloc info (smaller binary)
CFLAGS = -s

TOOLS = pracc-init pracc-edit pracc-view pracc-kill \
 pracc-sum pracc-purge pracc-check pracc-log pracc-ok

all: backend tools gui
backend: cupspracc
tools: $(TOOLS)
gui: pracc.cgi

install: cupspracc pracc.cgi tools
	install -d $(PRACCBIN) $(PRACCDOC) $(PRACCCGI)
	install -o root -g root -m 755 pracc-init $(PRACCBIN)
	install -o root -g root -m 755 pracc-edit $(PRACCBIN)
	install -o root -g root -m 755 pracc-view $(PRACCBIN)
	install -o root -g root -m 755 pracc-kill $(PRACCBIN)
	install -o root -g root -m 755 pracc-sum $(PRACCBIN)
	install -o root -g root -m 755 pracc-check $(PRACCBIN)
	install -o root -g root -m 755 pracc-log $(PRACCBIN)
	install -o root -g root -m 755 pracc-ok $(PRACCBIN)
	install -o root -g $(PRACCGROUP) -m 700 cupspracc $(BACKDIR)/pracc
	install -o root -g root -m 755 pracc.cgi $(PRACCCGI)/pracc.cgi
	cp -a doc/* $(PRACCDOC)
	chown -R root:root $(PRACCDOC)

# Generate the pracc.h header:

pracc.h: Makefile subst
	./subst "PRACCOWNER=$(PRACCOWNER)" \
	 "PRACCGROUP=$(PRACCGROUP)" \
	 "PRACCDEFLT=$(PRACCDEFLT)" \
	 "PRACCLOG=$(PRACCLOG)" \
	 "PRACCPCLOG=$(PRACCPCLOG)" \
	 "PRACCDIR=$(PRACCDIR)" \
	 "PRACCBIN=$(PRACCBIN)" \
	 "PRACCDOC=$(PRACCDOC)" \
	 "PRACCCGI=$(PRACCCGI)" \
	 "PRACCPEEK=$(PRACCPEEK)" \
	 "PRACCPOKE=$(PRACCPOKE)" \
	 pracc.t > pracc.h

# The CUPS backend:

cupspracc: cupspracc.o pjl.o ps.o scans.o printsn.o pracclib.a
	gcc -lcups -o $@@ $+
cupspracc.o: cupspracc.c pracc.h pjl.h ps.h print.h tai.h

pstest:	ps.o
	gcc -D TESTING -o pstest ps.c scani.c scanu.c
ps.o: ps.c ps.h

pjltest: pjl.o
	gcc -D TESTING -o pjltest pjl.c scani.c scanu.c
pjl.o: pjl.c pjl.h

# Pracc tools:

pracc-init: pracc-init.o common.a pracclib.a
pracc-init.o: pracc-init.c common.h pracc.h print.h scan.h streq.h

pracc-edit: pracc-edit.o common.a pracclib.a
pracc-edit.o: pracc-edit.c common.h pracc.h print.h scan.h streq.h

pracc-view: pracc-view.o printstm.o tailocal.o common.a pracclib.a
pracc-view.o: pracc-view.c common.h pracc.h scan.h streq.h

pracc-kill: pracc-kill.o common.a pracclib.a
pracc-kill.o: pracc-kill.c common.h pracc.h print.h

pracc-sum: pracc-sum.o tailocal.o common.a pracclib.a
pracc-sum.o: pracc-sum.c common.h pracc.h print.h scan.h tai.h

pracc-purge: pracc-purge.o common.a pracclib.a
pracc-purge.o: pracc-purge.c common.h pracc.h print.h scan.h tai.h

pracc-check: pracc-check.o printsn.o common.a pracclib.a
pracc-check.o: pracc-check.c common.h pracc.h print.h streq.h

pracc-log: pracc-log.o printstm.o tailocal.o common.a pracclib.a
pracc-log.o: pracc-log.c common.h pracc.h scan.h streq.h tai.h

pracc-ok: pracc-ok.o common.a pracclib.a
pracc-ok.o: pracc-ok.c common.h pracc.h

# Pracc Web GUI

pracc.cgi.o: pracc.cgi.c pracc.h symtab.h cgi.h backdate.h \
        acct.h accts.h pclog.h pracclog.h report.h
pracc.cgi: pracc.cgi.o subst.o symtab.o cgi.o backdate.c common.a \
        acct.o accts.o pclog.o pracclog.o report.o tailocal.o pracclib.a

# Subst must not depend on pracc.h, not even transitively!
subst: subst.c symtab.h scan.h
	cc -D STANDALONE -o $@@ subst.c symtab.c progname.c scani.c scanu.c

pclog: pclog.c symtab.h symtab.c pracc.h common.h getln.h tai.h
	cc -D TESTING -o $@@ pclog.c symtab.c getln.c scani.c scanu.c \
	scandate.c taiscan.c taifmt.c taistore.c tailocal.c common.a

accts: accts.c pracc.h tai.h
	cc -D TESTING -o $@@ accts.c pracclib.a common.a

acct.o: acct.c acct.h pracc.h tai.h
accts.o: accts.c accts.h pracc.h tai.h
backdate.o: backdate.c backdate.h scan.h
cgi.o: cgi.c cgi.h pracc.h
pclog.o: pclog.c getln.h pclog.h pracc.h symtab.h tai.h
pracclog.o: pracclog.c pracc.h pracclog.h tai.h
report.o: report.c pracc.h report.h symtab.h
subst.o: subst.c pracc.h scan.h symtab.h
symtab.o: symtab.c symtab.h

# Pracc API:

pracclib: pracclib.a
pracclib.a: praccAppend.o praccAssemble.o praccCheckName.o praccCreate.o \
	praccFormatInfo.o praccFormatName.o praccGrant.o praccLogRead.o \
	praccLogup.o praccPath.o praccPurge.o praccRead.o praccSum.o \
	praccTypeString.o praccAccountInfo.o praccDelete.o \
	hasgroup.o getln.o \
	taifmt.o tainow.o taiscan.o taistore.o \
	scandate.o scani.o scanpat.o scanu.o \
	prints.o printu.o printi.o
	rm -f $@@
	ar cr $@@ $+
	ranlib $@@

praccAppend.o: praccAppend.c pracc.h
praccCheckName.o: praccCheckName.c pracc.h
praccCreate.o: praccCreate.c pracc.h print.h
praccDelete.o: praccDelete.c pracc.h
praccAssemble.o: praccAssemble.c pracc.h print.h tai.h
praccFormatInfo.o: praccFormatInfo.c pracc.h
praccFormatName.o: praccFormatName.c pracc.h
praccGrant.o: praccGrant.c pracc.h hasgroup.h
praccLogRead.o: praccLogRead.c pracc.h getln.h scan.h tai.h
praccLogup.o: praccLogup.c pracc.h print.h
praccPath.o: praccPath.c pracc.h
praccPurge.o: praccPurge.c pracc.h print.h
praccRead.o: praccRead.c pracc.h getln.h tai.h
praccSum.o: praccSum.c pracc.h
praccTypeString.o: praccTypeString.c pracc.h
praccAccountInfo.o: praccAccountInfo.c pracc.h

# Utilities:

common.a: putln.o putfmt.o putbuf.o die.o progname.o
	rm -f $@@
	ar cr $@@ $+
	ranlib $@@

progname.o: progname.c
die.o: die.c
getln.o: getln.c getln.h
putln.o: putln.c
putfmt.o: putfmt.c
putbuf.o: putbuf.c

delay.o: delay.c delay.h
hasgroup.o: hasgroup.c hasgroup.h

prints.o: prints.c print.h
printu.o: printu.c print.h
printi.o: printi.c print.h
printsn.o: printsn.c print.h
printstm.o: printstm.c print.h

scans.o: scans.c scan.h
scanu.o: scanu.c scan.h
scani.o: scani.c scan.h
scanpat.o: scanpat.c scan.h
scandate.o: scandate.c scan.h

taifmt.o: taifmt.c tai.h
taiload.o: taiload.c tai.h
tailocal.o: tailocal.c tai.h
tainow.o: tainow.c tai.h
taiscan.o: taiscan.c tai.h
taistore.o: taistore.c tai.h

# Administration

clean:
	rm -f cupspracc $(TOOLS) pracc.cgi subst *.o common.a pracclib.a

tgz: clean
	(cd ..; tar chzvf pracc-`date +%Y%m%d`.tgz pracc)

dist: clean
	(V=`head -1 VERSION`; cd ..; tar chzvf pracc-v$$V.tgz \
	 --exclude RCS --exclude legacy --exclude test pracc)

@


1.5
log
@*** empty log message ***
@
text
@d2 1
a2 1
# $Id: Makefile,v 1.4 2008/04/04 16:40:19 ujr Exp ujr $
d4 24
a27 1
# Must match pracc.h !!
d29 1
a29 2
PRACCGROUP = lpadmin
PRACCWEBUI = /var/print/cgi/pracc.cgi
d31 2
d34 4
a37 5
# Ubuntu w/CUPS 1.3.2:
BACKDIR = /usr/lib/cups/backend

# Gentoo w/CUPS 1.2.9:
#BACKDIR = /usr/libexec/cups/backend
d51 1
a51 1
	install -d $(PRACCBIN) $(PRACCDOC)
a56 1
	install -o root -g root -m 755 pracc-purge $(PRACCBIN)
d60 2
a61 2
	install -D -o root -g $(PRACCGROUP) -m 700 cupspracc $(BACKDIR)/pracc
	install -D -o root -g root -m 755 pracc.cgi $(PRACCWEBUI)
d65 16
d127 1
a127 1
        acct.h accts.h pclog.h pracclog.h
d129 1
a129 1
        acct.o accts.o pclog.o pracclog.o tailocal.o pracclib.a
d131 1
d133 1
a133 1
	cc -D TESTING -o $@@ subst.c symtab.c progname.c pracclib.a
d148 1
@


1.4
log
@Added web GUI stuff
@
text
@d1 2
a2 2
# Makefile for pracc et al.
# $Id: Makefile,v 1.3 2008/03/03 10:13:36 ujr Exp ujr $
d6 2
a7 1
PRACCCGI = /var/print/cgi
a8 1
PRACCGROUP = lpadmin
d28 1
a28 3
	install -d $(PRACCCGI) $(PRACCDOC) $(PRACCBIN)
	install -o root -g $(PRACCGROUP) -m 700 cupspracc $(BACKDIR)/pracc
	install -o root -g root -m 755 pracc.cgi $(PRACCCGI)/pracc.cgi
d32 1
d38 2
a85 4
#convert: convert.c praccRead.c pracc.h tai.h common.a pracclib.a
#	cc -o $@@ convert.c -D OLDSTAMP praccRead.c praccPath.c pracclib.a \
#	oldscan.c scans.c scandate.c /home/ujr/src/myclib/scantime.c common.a

a143 11
# Timestamp stuff:

#taistamp: taistamp.c taistamp.h tai.h tainow.c taistore.c print.h
#	cc -o taistamp -DTAISTAMP taistamp.c tainow.c taifmt.o taistore.c \
#	taiscan.c tailocal.c printu.c printstm.c
utcstamp: utcstamp.c utcstamp.h print.h
	cc -o utcstamp -DUTCSTAMP utcstamp.c printu.c
utc2tai: utc2tai.c tai.h scan.h
	cc -o utc2tai utc2tai.c utcscan.c taistore.c \
	scandate.c scantime.c scanfix.c

d183 1
a183 1
	rm -f cupspracc $(TOOLS) subst *.o common.a pracclib.a
@


1.3
log
@Changed to install the backend as "pracc", not "cupspracc".
@
text
@d2 1
a2 1
# $Id: Makefile,v 1.2 2008/01/16 23:30:56 ujr Exp ujr $
d4 1
a4 1
# Must match pracc.h
d6 2
d16 1
a16 3
# My system w/CUPS 1.3.5:
#BACKDIR = /usr/local/lib/cups/backend

d19 2
a20 2
TOOLS = pracc-init pracc-edit pracc-view pracc-sum \
 pracc-purge pracc-check pracc-log pracc-ok
d22 1
a22 1
all: backend tools
d25 1
d27 2
a28 1
install: cupspracc tools
d30 1
d38 3
a55 4
#jobscan: jobscan.o scans.o scanu.o
#	gcc -D TESTING -o jobscan jobscan.c scans.c scanu.c
#jobscan.o: jobscan.c scan.h

d67 3
d85 30
d117 1
d121 2
a122 1
	praccType.o hasgroup.o getln.o \
d130 1
a130 2
praccAppend.o: praccAppend.c pracc.h print.h
praccAssemble.o: praccAssemble.c pracc.h print.h tai.h
d133 2
d141 1
a141 1
praccPurge.o: praccPurge.c pracc.h
d144 2
a145 1
praccType.o: praccType.c pracc.h
d194 2
d197 1
a197 1
	rm -f cupspracc $(TOOLS) pstest pjltest *.o pracclib.a
d201 5
@


1.2
log
@*** empty log message ***
@
text
@d2 1
a2 1
# $Id: Makefile,v 1.1 2008/01/16 15:54:27 ujr Exp ujr $
d6 10
a15 2
PRACCGROUP = lp
BACKENDDIR = /usr/lib/cups/backend
d19 1
a19 1
TOOLS = pracc-init pracc-edit pracc-view pracc-sum pracc-debit \
d27 1
a27 1
	install -o root -g $(PRACCGROUP) -m 2755 cupspracc $(BACKENDDIR)
a31 1
	install -o root -g $(PRACCGROUP) -m 2755 pracc-debit $(PRACCBIN)
d38 3
a40 4
CUPSPRACCOBJ = cupspracc.o praccname.o praccaccess.o praccpath.o praccread.o praccwrite.o scanu.o scani.o printu.o printi.o prints.o printsn.o hasgroup.o taistamp.o taifmt.o taistore.o tainow.o ps.o pjl.o
cupspracc: $(CUPSPRACCOBJ)
	gcc -lcups -o $@@ $(CUPSPRACCOBJ)
cupspracc.o: cupspracc.c pracc.h pjl.h ps.h taistamp.h print.h
d50 3
a52 3
jobscan: jobscan.o scans.o scanu.o
	gcc -D TESTING -o jobscan jobscan.c scans.c scanu.c
jobscan.o: jobscan.c scan.h
d56 23
a78 50
pracc-init: pracc-init.o common.o praccname.o praccpath.o \
	format.o taistamp.o taifmt.o tainow.c taistore.c \
	printu.o printi.o prints.o printsn.o scanu.o scani.o
pracc-init.o: pracc-init.c common.h pracc.h print.h scan.h \
	streq.h taistamp.h

pracc-edit: pracc-edit.o common.o praccname.o praccpath.o praccwrite.o \
	format.o taistamp.o taifmt.o tainow.c taistore.c \
	printu.o printi.o prints.o printsn.o scanu.o scani.o
pracc-edit.o: pracc-edit.c common.h pracc.h print.h scan.h \
	streq.h taistamp.h

pracc-view: pracc-view.o common.o format.o praccname.o praccpath.o \
	utcinit.o utcscan.o taiscan.o tailocal.o \
	scans.o scanu.o scani.o scandate.o scantime.o \
	printstm.o printu.o
pracc-view.o: pracc-view.c common.h pracc.h scan.h streq.h \
	taistamp.h utcstamp.h

pracc-sum: pracc-sum.o common.o format.o praccname.o praccpath.o \
	printi.o printu.o scanu.o scani.o scandate.o scantime.o \
	utcinit.o utcscan.o taiscan.o tailocal.o
pracc-sum.o: pracc-sum.c common.h pracc.h print.h scan.h \
	tai.h taistamp.h utcstamp.h

pracc-debit: pracc-debit.o common.o format.o hasgroup.o \
	praccpath.o praccwrite.o praccname.o praccaccess.o \
	printu.o printi.o prints.o scanu.o \
	taistamp.o taifmt.o taistore.o tainow.o
pracc-debit.o: pracc-debit.c common.h pracc.h print.h scan.h

pracc-purge: pracc-purge.o common.o format.o praccname.o praccpath.o \
	scans.o scanu.o scani.o scandate.o scantime.o utcscan.o \
	taistamp.o tainow.o taifmt.o taistore.o taiscan.o tailocal.o \
	printi.o printu.o prints.o printsn.o
pracc-purge.o: pracc-purge.c common.h pracc.h print.h scan.h \
	tai.h taistamp.h

pracc-check: pracc-check.o common.o format.o praccname.o \
	prints.o printsn.o
pracc-check.o: pracc-check.c pracc.h print.h streq.h

pracc-log: pracc-log.o common.o format.o praccname.o \
	scanu.o scandate.o scanpat.o \
	taiscan.o tailocal.o printstm.o printu.o
pracc-log.o: pracc-log.c common.h pracc.h scan.h streq.h tai.h taistamp.h

pracc-ok: pracc-ok.o common.o praccname.o praccpath.o praccread.o \
	format.o scanu.o scani.o
pracc-ok.o: pracc-ok.c pracc.h common.h
d82 25
a106 5
praccname.o: praccname.c pracc.h
praccpath.o: praccpath.c pracc.h
praccread.o: praccread.c pracc.h
praccwrite.o: praccwrite.c pracc.h
praccaccess.o: praccaccess.c pracc.h
d110 3
a112 3
taistamp: taistamp.c taistamp.h tai.h tainow.c taistore.c print.h
	cc -o taistamp -DTAISTAMP taistamp.c tainow.c taifmt.o taistore.c \
	taiscan.c tailocal.c printu.c printstm.c
d121 12
a132 1
common.o: common.c common.h
a133 1
format.o: format.c format.h
d145 1
a146 6
scantime.o: scantime.c scan.h
scanpat.o: scanpat.c scan.h

utcinit.o: utcinit.c utcstamp.h
utcscan.o: utcscan.c utcstamp.h
utcstamp.o: utcstamp.c utcstamp.h
d150 1
a154 3
tailocal.o: tailocal.c taistamp.h tai.h
taistamp.o: taistamp.c taistamp.h tai.h

d156 1
a156 1
	rm -f cupspracc $(TOOLS) pstest pjltest *.o
@


1.1
log
@Initial revision
@
text
@d2 1
a2 1
# $Id$
d44 4
d64 1
a64 1
	scanu.o scani.o scandate.o scantime.o scanfix.o \
d82 1
a82 1
	scanu.o scani.o scandate.o scantime.o scanfix.o \
d84 1
a84 1
	utcscan.o printi.o printu.o prints.o printsn.o
d93 1
a93 1
	scanu.o scandate.o scantime.o scanpat.o \
d126 2
a129 1
prints.o: prints.c print.h
d131 3
d138 1
d144 2
a145 1
taistamp.o: taistamp.c taistamp.h tai.h
d147 1
a147 1
taiload.o: taiload.c tai.h
d149 3
a151 2
taifmt.o: taifmt.c tai.h
taiscan.o: taiscan.c tai.h
@
